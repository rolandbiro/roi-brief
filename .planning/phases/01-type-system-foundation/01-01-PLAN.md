---
phase: 01-type-system-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/schemas/brief-base.ts
  - lib/schemas/campaign-types.ts
  - lib/schemas/media-buying.ts
  - lib/schemas/performance.ts
  - lib/schemas/brand.ts
  - lib/schemas/social.ts
  - lib/schemas/brief-data.ts
  - lib/schemas/index.ts
  - lib/prompts/base.ts
  - lib/prompts/types/media-buying.ts
  - lib/prompts/types/performance.ts
  - lib/prompts/types/brand.ts
  - lib/prompts/types/social.ts
  - lib/prompts/compose.ts
  - lib/prompts/extraction.ts
  - lib/prompts/index.ts
  - types/brief.ts
autonomous: true

must_haves:
  truths:
    - "BriefData Zod sémából z.infer-rel derivált TypeScript típus (nem kézi interface)"
    - "4 kampánytípus (media_buying, performance_ppc, brand_awareness, social_media) z.discriminatedUnion-nel definiálva"
    - "Típusonként külön prompt modul létezik, composeSystemPrompt() dinamikusan állítja össze"
    - "Extraction prompt külön fájlban, a structured output híváshoz"
  artifacts:
    - path: "lib/schemas/brief-base.ts"
      provides: "BriefBase Zod schema a bővített base mezőkkel"
      contains: "BriefBaseSchema"
    - path: "lib/schemas/brief-data.ts"
      provides: "BriefData discriminated union schema"
      contains: "BriefDataSchema"
    - path: "lib/prompts/compose.ts"
      provides: "composeSystemPrompt function"
      exports: ["composeSystemPrompt"]
    - path: "lib/prompts/extraction.ts"
      provides: "EXTRACTION_PROMPT for structured output"
      exports: ["EXTRACTION_PROMPT"]
    - path: "types/brief.ts"
      provides: "BriefData TypeScript type re-export"
      exports: ["BriefData", "BriefBase", "CampaignType"]
  key_links:
    - from: "lib/schemas/brief-data.ts"
      to: "lib/schemas/brief-base.ts"
      via: "BriefBaseSchema.extend()"
      pattern: "BriefBaseSchema\\.extend"
    - from: "lib/prompts/compose.ts"
      to: "lib/schemas/campaign-types.ts"
      via: "CampaignType import for type-safe module lookup"
      pattern: "import.*CampaignType"
    - from: "types/brief.ts"
      to: "lib/schemas/brief-data.ts"
      via: "z.infer re-export"
      pattern: "z\\.infer.*BriefDataSchema"
---

<objective>
Zod sémák és moduláris prompt rendszer felépítése a 4 kampánytípushoz.

Purpose: Ez az alapréteg, amire az egész Phase 1 (és később Phase 2-3) épül. A Zod sémák az egyetlen forrás (single source of truth) a brief adatstruktúrához, a moduláris promptok pedig a típusspecifikus AI viselkedéshez.

Output: `lib/schemas/` mappa a teljes Zod séma hierarchiával, `lib/prompts/` mappa a moduláris prompt rendszerrel, `types/brief.ts` a z.infer re-exporttal.
</objective>

<execution_context>
@/Users/biroroland/.claude/get-shit-done/workflows/execute-plan.md
@/Users/biroroland/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-type-system-foundation/01-RESEARCH.md
@.planning/phases/01-type-system-foundation/01-CONTEXT.md
@types/chat.ts
@lib/prompts.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Zod sémák definiálása (base + 4 kampánytípus + union)</name>
  <files>
    lib/schemas/brief-base.ts
    lib/schemas/campaign-types.ts
    lib/schemas/media-buying.ts
    lib/schemas/performance.ts
    lib/schemas/brand.ts
    lib/schemas/social.ts
    lib/schemas/brief-data.ts
    lib/schemas/index.ts
  </files>
  <action>
Hozd létre a `lib/schemas/` mappát a következő fájlokkal:

**campaign-types.ts:**
- `CampaignTypeEnum = z.enum(['media_buying', 'performance_ppc', 'brand_awareness', 'social_media'])`
- `type CampaignType = z.infer<typeof CampaignTypeEnum>` export
- CAMPAIGN_TYPE_LABELS: Record<CampaignType, string> a magyar nevekkel (Médiavásárlás, Performance/PPC, Brand/Awareness, Social Media)

**brief-base.ts:**
- `BriefBaseSchema = z.object({...})` a CONTEXT.md locked decision alapján:
  - company_name: z.string() -- cégnév
  - industry: z.string() -- iparág
  - campaign_goal: z.string() -- kampány célja
  - timing: z.string() -- időzítés
  - budget_range: z.string() -- büdzsékeret
  - target_audience: z.string() -- célcsoport
  - existing_materials: z.string().optional() -- meglévő anyagok
  - previous_campaigns: z.string().optional() -- korábbi kampány tapasztalatok
  - competitors: z.array(z.string()) -- versenytársak
  - notes: z.string().optional() -- egyéb megjegyzések
- Minden mező .describe()-el, magyar leírással (a structured output ezeket description-ként használja)
- `type BriefBase = z.infer<typeof BriefBaseSchema>` export

**media-buying.ts:**
- `MediaBuyingBriefSchema = BriefBaseSchema.extend({...})` -- campaign_type: z.literal('media_buying'), + media_specific z.object:
  - grp_target: z.string().optional() -- célzott GRP
  - reach_target: z.string().optional() -- elvárt elérés
  - frequency_cap: z.string().optional() -- frekvencia limit
  - media_types: z.array(z.string()) -- médiatípusok (TV, rádió, outdoor, digital display)
  - daypart_preferences: z.string().optional() -- napszak preferenciák
  - viewability_requirements: z.string().optional() -- viewability elvárások

**performance.ts:**
- `PerformanceBriefSchema = BriefBaseSchema.extend({...})` -- campaign_type: z.literal('performance_ppc'), + performance_specific z.object:
  - target_roas: z.string().optional() -- cél ROAS
  - target_cpa: z.string().optional() -- cél CPA
  - conversion_events: z.array(z.string()) -- konverziós események
  - landing_pages: z.array(z.string()) -- landing page-ek
  - ad_accounts: z.string().optional() -- hirdetési fiókok
  - attribution_model: z.string().optional() -- attribúciós modell

**brand.ts:**
- `BrandBriefSchema = BriefBaseSchema.extend({...})` -- campaign_type: z.literal('brand_awareness'), + brand_specific z.object:
  - brand_lift_target: z.string().optional() -- brand lift cél
  - message_recall_target: z.string().optional() -- üzenetrecall cél
  - creative_concept: z.string().optional() -- kreatív koncepció
  - tonality: z.string().optional() -- hangvétel/tonalitás
  - positioning: z.string().optional() -- pozicionálás
  - awareness_channels: z.array(z.string()) -- awareness csatornák

**social.ts:**
- `SocialBriefSchema = BriefBaseSchema.extend({...})` -- campaign_type: z.literal('social_media'), + social_specific z.object:
  - organic_paid_mix: z.string().optional() -- organikus/paid arány
  - platforms: z.array(z.string()) -- platformok (Facebook, Instagram, TikTok, LinkedIn, stb.)
  - content_types: z.array(z.string()) -- tartalom típusok (kép, videó, story, reel, stb.)
  - community_management: z.string().optional() -- közösségkezelés
  - influencer_plan: z.string().optional() -- influencer terv
  - posting_frequency: z.string().optional() -- posztolási gyakoriság

**brief-data.ts:**
- `BriefDataSchema = z.discriminatedUnion('campaign_type', [MediaBuyingBriefSchema, PerformanceBriefSchema, BrandBriefSchema, SocialBriefSchema])`
- `type BriefData = z.infer<typeof BriefDataSchema>` export
- FONTOS: a campaign_type top-level mező kell legyen (nem nested), mert a z.discriminatedUnion() nem támogatja a nested key-eket

**index.ts:**
- Re-export minden publikus séma és típus: BriefBaseSchema, BriefDataSchema, CampaignTypeEnum, minden típus-specifikus schema, BriefBase, BriefData, CampaignType, CAMPAIGN_TYPE_LABELS
  </action>
  <verify>
npx tsc --noEmit (a lib/schemas/ fájloknak hiba nélkül kell fordulniuk)
  </verify>
  <done>
8 fájl létezik a lib/schemas/ mappában. BriefDataSchema z.discriminatedUnion 4 típussal. Minden típusspecifikus schema BriefBaseSchema.extend()-del bővít. TypeScript típusok z.infer-rel deriválva.
  </done>
</task>

<task type="auto">
  <name>Task 2: Moduláris prompt rendszer felépítése</name>
  <files>
    lib/prompts/base.ts
    lib/prompts/types/media-buying.ts
    lib/prompts/types/performance.ts
    lib/prompts/types/brand.ts
    lib/prompts/types/social.ts
    lib/prompts/compose.ts
    lib/prompts/extraction.ts
    lib/prompts/index.ts
  </files>
  <action>
Hozd létre a `lib/prompts/` mappát (a régi `lib/prompts.ts` MARAD egyelőre -- Plan 02 fogja törölni, amikor az API route-ot átírja):

**base.ts:**
- `BASE_PROMPT` konstans export -- a CONTEXT.md locked decisions alapján:
  - ROI Works brief asszisztens bemutatkozás
  - Megszólítás szabály: alapból magáz, de ha az érdeklődő tegez, átváll tegezésre
  - Személyiség: barátságos segítő, kedves, türelmes, könnyedebb hang
  - Szakmai de nem ijesztő: szakmai kifejezéseket használ, de megmagyarázza ha kell
  - MINDIG csak egy kérdés egyszerre
  - Minden kérdéshez adj rövid kontextust, ami segíti a válaszadást
  - Bemutatkozó üzenet: "Üdvözöljük! A ROI Works brief asszisztense vagyok. Segítek összeállítani a kampány briefjét..." (Claude's Discretion -- a pontos szöveg ezen belül szabad)
  - NE tartalmazza a régi BRIEF_JSON_START/END mintát -- structured output-ra váltunk
  - A prompt NEM tartalmaz fix mezősorrendet -- az AI a beszélgetés alapján kérdez

**types/media-buying.ts:**
- `MEDIA_BUYING_MODULE` export -- médiavásárlás-specifikus kérdéskészlet:
  - GRP (Gross Rating Point) célérték -- rövid magyarázattal ha az ügyfél nem ismeri
  - Elvárt reach és frequency
  - Médiatípusok preferenciája (TV, rádió, outdoor, digital display)
  - Viewability elvárások
  - Napszak-preferenciák (dayparting)
  - A prompt inkább útmutató az AI-nak, nem fix kérdéslista

**types/performance.ts:**
- `PERFORMANCE_MODULE` export -- PPC specifikus:
  - Cél ROAS / CPA
  - Konverziós események definiálása
  - Landing page-ek
  - Meglévő hirdetési fiókok
  - Attribúciós modell

**types/brand.ts:**
- `BRAND_MODULE` export -- brand/awareness specifikus:
  - Brand lift és üzenetrecall célok
  - Kreatív koncepció
  - Tonalitás / hangvétel
  - Pozicionálás
  - Awareness csatornák

**types/social.ts:**
- `SOCIAL_MODULE` export -- social media specifikus:
  - Organikus/paid arány
  - Platform választás
  - Tartalom típusok
  - Közösségkezelés
  - Influencer terv
  - Posztolási gyakoriság

**compose.ts:**
- `composeSystemPrompt(types: CampaignType[]): string` export
  - Import BASE_PROMPT + mind a 4 modul
  - TYPE_MODULES: Record<CampaignType, string> mapping
  - Ha types üres tömb: csak BASE_PROMPT (még nem ismert a típus)
  - Ha types nem üres: BASE_PROMPT + releváns modulok join-olva

**extraction.ts:**
- `EXTRACTION_PROMPT` export -- a structured output hívás system promptja
  - Utasítja az AI-t hogy a beszélgetésből kinyerje a brief adatokat
  - A séma mezőit töltse ki amennyire lehet a beszélgetés alapján
  - Hiányzó adatot hagyja üresen (optional mezők)
  - Magyar kontextusban gondolkodjon
  - NE tartalmazzon JSON formátum leírást (a zodOutputFormat ezt kezeli)

**index.ts:**
- Re-export: BASE_PROMPT, composeSystemPrompt, EXTRACTION_PROMPT, minden típus modul
  </action>
  <verify>
npx tsc --noEmit (a lib/prompts/ fájloknak hiba nélkül kell fordulniuk)
  </verify>
  <done>
8 fájl létezik a lib/prompts/ mappában. composeSystemPrompt() CampaignType tömböt fogad és dinamikusan állítja össze a system promptot. EXTRACTION_PROMPT külön fájlban a structured output híváshoz.
  </done>
</task>

<task type="auto">
  <name>Task 3: TypeScript típus re-export és backward compatibility</name>
  <files>
    types/brief.ts
  </files>
  <action>
Hozd létre a `types/brief.ts` fájlt:

- Import és re-export z.infer típusok a lib/schemas-ból:
  - `export type { BriefData, BriefBase } from "@/lib/schemas"`
  - `export type { CampaignType } from "@/lib/schemas"`
  - `export { CampaignTypeEnum, CAMPAIGN_TYPE_LABELS } from "@/lib/schemas"`
  - `export { BriefDataSchema, BriefBaseSchema } from "@/lib/schemas"`

A `types/chat.ts` fájlt NE módosítsd -- az megmarad a Message interface-szel. A régi BriefData interface a chat.ts-ben marad egyelőre (Plan 02-03 fogja átállítani a fogyasztókat types/brief.ts-re, és a chat.ts-ből törli a BriefData-t).
  </action>
  <verify>
npx tsc --noEmit (types/brief.ts-nek hiba nélkül kell fordulnia, és az exportok elérhetők kell legyenek "@/types/brief" path-on)
  </verify>
  <done>
types/brief.ts létezik, BriefData és BriefBase típusok z.infer-rel deriválva és exportálva. A "@/types/brief" path-on elérhető minden típus és séma.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` -- Teljes TypeScript fordítás hiba nélkül
2. `ls lib/schemas/` -- 8 fájl (brief-base, campaign-types, media-buying, performance, brand, social, brief-data, index)
3. `ls lib/prompts/` -- base.ts, compose.ts, extraction.ts, index.ts + types/ mappa 4 fájllal
4. `ls types/brief.ts` -- Létezik
5. A BriefDataSchema z.discriminatedUnion 4 típussal (grep: "discriminatedUnion")
6. A composeSystemPrompt CampaignType tömböt fogad (grep: "composeSystemPrompt")
</verification>

<success_criteria>
- Zod sémák definiálják a BriefData struktúrát (TECH-01, TECH-05)
- 4 kampánytípus z.discriminatedUnion-nel (TYPE-04 részben, TECH-01)
- Moduláris prompt rendszer (TECH-03): composeSystemPrompt() dinamikusan állítja össze
- Extraction prompt külön fájlban a structured output híváshoz (TECH-02 előkészítés)
- TypeScript típusok z.infer-rel, nem kézi interface
</success_criteria>

<output>
After completion, create `.planning/phases/01-type-system-foundation/01-01-SUMMARY.md`
</output>
