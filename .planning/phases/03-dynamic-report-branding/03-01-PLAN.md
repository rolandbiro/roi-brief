---
phase: 03-dynamic-report-branding
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/brief-sections.ts
  - components/BriefEditor.tsx
  - app/brief/page.tsx
autonomous: true

must_haves:
  truths:
    - "A BriefEditor read-only áttekintést mutat, nem szerkeszthető form"
    - "Üres mezők nem jelennek meg az áttekintésben"
    - "Típusspecifikus szekciók megjelennek a kampánytípus alapján"
    - "Email cím mező a jóváhagyás oldalon kérhető"
    - "Jóváhagyás után siker oldal jelenik meg PDF letöltés gombbal"
  artifacts:
    - path: "lib/brief-sections.ts"
      provides: "Dinamikus szekció helper (getActiveSections, hasValue, SECTION_DEFS)"
      exports: ["getActiveSections", "hasValue"]
    - path: "components/BriefEditor.tsx"
      provides: "Read-only brief áttekintés + email + jóváhagyás + siker oldal"
    - path: "app/brief/page.tsx"
      provides: "Brief page flow: chat → áttekintés gomb → BriefEditor"
  key_links:
    - from: "components/BriefEditor.tsx"
      to: "lib/brief-sections.ts"
      via: "getActiveSections(briefData)"
      pattern: "getActiveSections"
    - from: "app/brief/page.tsx"
      to: "components/BriefEditor.tsx"
      via: "BriefEditor render when briefData exists"
      pattern: "BriefEditor"
---

<objective>
Dinamikus szekció helper és read-only brief áttekintés a flat BriefData sémával.

Purpose: A chat után az érdeklődő read-only áttekintésben látja a brief adatokat, típusspecifikus szekcióval, és jóváhagyás után siker oldalt kap. Ez a Phase 3 UI alapja.
Output: lib/brief-sections.ts helper + átírt BriefEditor.tsx + frissített brief page flow
</objective>

<execution_context>
@/Users/biroroland/.claude/get-shit-done/workflows/execute-plan.md
@/Users/biroroland/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-dynamic-report-branding/03-RESEARCH.md
@lib/schemas/brief-data.ts
@lib/schemas/brief-base.ts
@lib/schemas/media-buying.ts
@lib/schemas/performance.ts
@lib/schemas/brand.ts
@lib/schemas/social.ts
@types/brief.ts
@components/BriefEditor.tsx
@app/brief/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Dinamikus szekció helper (lib/brief-sections.ts)</name>
  <files>lib/brief-sections.ts</files>
  <action>
Hozz létre `lib/brief-sections.ts` fájlt a következő tartalommal:

1. `hasValue(value: unknown): boolean` — visszaadja true-t ha az érték nem undefined, nem null, nem üres string, és nem üres tömb.

2. `FieldDef` interface: `{ key: string; label: string }` — ahol key a BriefData mező path (pl. "company_name" vagy "media_specific.grp_target").

3. `SectionDef` interface: `{ title: string; fields: FieldDef[]; condition?: (data: BriefData) => boolean }`.

4. `getNestedValue(obj: Record<string, unknown>, path: string): unknown` — pont-szeparált path alapján kiolvassa a nested értéket.

5. `formatValue(value: unknown): string | null` — ha hasValue true, formázza: tömb → join(", "), egyébként String(value). Ha nincs érték, null.

6. `BASE_SECTIONS: SectionDef[]` — Alap szekciók (mindig megjelennek ha van adat):
   - "Cégadatok": company_name (Cégnév), industry (Iparág)
   - "Kampány": campaign_goal (Kampány célja), timing (Időzítés), budget_range (Büdzsé), target_audience (Célcsoport)
   - "Egyéb": existing_materials (Meglévő anyagok), previous_campaigns (Korábbi kampányok), competitors (Versenytársak), notes (Megjegyzések)

7. `TYPE_SECTIONS: Record<CampaignType, SectionDef>` — Típusspecifikus szekciók:
   - "media_buying": "Médiavásárlás részletek" — media_specific.grp_target (Célzott GRP), media_specific.reach_target (Elvárt elérés), media_specific.frequency_cap (Frekvencia limit), media_specific.media_types (Médiatípusok), media_specific.daypart_preferences (Napszak preferenciák), media_specific.viewability_requirements (Viewability elvárások)
   - "performance_ppc": "Performance/PPC részletek" — performance_specific.target_cpa (Cél CPA), performance_specific.target_roas (Cél ROAS), performance_specific.conversion_events (Konverziós események), performance_specific.landing_page_url (Landing page), performance_specific.tracking_setup (Mérés beállítás), performance_specific.ad_account_access (Hirdetési fiók hozzáférés)
   - "brand_awareness": "Brand/Awareness részletek" — brand_specific.brand_lift_goals (Brand lift célok), brand_specific.message_recall_target (Üzenetrecall cél), brand_specific.creative_concept (Kreatív koncepció), brand_specific.tone_of_voice (Hangnem), brand_specific.brand_positioning (Pozicionálás)
   - "social_media": "Social Media részletek" — social_specific.platforms (Platformok), social_specific.organic_paid_mix (Organikus/fizetett arány), social_specific.content_types (Tartalomtípusok), social_specific.community_management (Közösségkezelés), social_specific.influencer_requirements (Influencer elvárások)

   Minden típus szekció condition-je: `(data) => data.campaign_types?.includes("TYPE_KEY")`.

   FONTOS: A mezőneveket a tényleges sémák mezőneveiből olvasd ki — nézd meg a media-buying.ts, performance.ts, brand.ts, social.ts fájlokat, és azok mezőneveit használd a FieldDef key-kben. NE feltételezd a mezőneveket, OLVASD KI!

8. `getActiveSections(data: BriefData): Array<{ title: string; fields: Array<{ label: string; value: string }> }>` — Összegyűjti az összes releváns szekciót (BASE_SECTIONS + típusspecifikusak), kiszűri az üres mezőket, és szűri az üres szekciókat.

Exportáld: hasValue, getActiveSections, SectionDef, FieldDef, BASE_SECTIONS, TYPE_SECTIONS.

Import: BriefData és CampaignType a @/types/brief-ből.
  </action>
  <verify>npx tsc --noEmit lib/brief-sections.ts — nincs TS hiba a fájlban. A getActiveSections egy üres BriefData-val üres tömböt ad vissza.</verify>
  <done>A lib/brief-sections.ts létezik, exportálja a getActiveSections-t és a szekció definíciókat, és a flat BriefData sémával működik.</done>
</task>

<task type="auto">
  <name>Task 2: BriefEditor átírás read-only nézetre + brief page flow frissítés</name>
  <files>components/BriefEditor.tsx, app/brief/page.tsx</files>
  <action>
**BriefEditor.tsx TELJES ÁTÍRÁS:**

A jelenlegi ~418 soros szerkeszthető formot cseréld le read-only áttekintésre. A komponens 3 állapotot kezel: "review" (áttekintés), "sending" (küldés folyamatban), "success" (siker).

Felépítés:
1. Props: `{ initialData: BriefData }` — az onBack prop eltűnik (nincs "vissza a chatbe" gomb, döntés szerint).

2. State: briefData (a megjelenített adat), clientEmail (email input), isSending, isSuccess, pdfDownloading.

3. **Review állapot:**
   - Fejléc: "Brief áttekintése" (nem "ellenőrzés") — `text-roi-orange` szín
   - Alcím: "Nézd át a brief adatokat, és ha minden rendben, hagyd jóvá és küldd el." (tegező!)
   - Kampánytípusok megjelenítése a fejlécben: `campaign_types` map-elése `CAMPAIGN_TYPE_LABELS`-szel, kis badge-ként (narancs háttér)
   - Szekciók: `getActiveSections(briefData)` iterálása — minden szekció egy card-ban:
     - Szekció cím narancs színnel (mint a jelenlegi, de kék sorszám badge nélkül)
     - Mezők: label (text-roi-gray-light, 13px) + value (text-white, 13px) — read-only, nincs input/textarea
   - Email mező: `clientEmail` input (ez az egyetlen input a oldalon) — label: "Add meg az email címed, hogy a ROI Works csapat elérhessen"
   - "Jóváhagyás és küldés" gomb (btn-primary, w-full) — handleSend hívja: POST /api/send-brief { briefData, clientEmail }
   - "PDF letöltés" gomb (btn-secondary) — handleDownloadPdf hívja: POST /api/download-pdf { briefData }

4. **handleSend:** POST /api/send-brief → isSuccess = true
5. **handleDownloadPdf:** POST /api/download-pdf → blob letöltés (createElement("a"), click, revokeObjectURL). A fájlnév: `roi-works-brief-${Date.now()}.pdf`.

6. **Success állapot:**
   - Megtartjuk a jelenlegi success nézetet (zöld pipa animáció), de a szöveg változik:
     - Cím: "Köszönjük!" + narancs span
     - Szöveg: "A brief sikeresen elküldve a ROI Works csapatnak. Hamarosan felvesszük veled a kapcsolatot!" (tegező!)
   - "PDF letöltés" gomb (btn-primary) — ugyanaz a handleDownloadPdf
   - "Új brief indítása" gomb (btn-secondary) — router.push("/")

7. Stílus: Megtartjuk a jelenlegi card/animate-fade-in-up mintákat. A Tailwind osztályok a meglévő konvenciókat követik (roi-orange, roi-gray-light, stb.).

**app/brief/page.tsx FRISSÍTÉS:**

- A gomb szövege "Brief megtekintése" → "Brief áttekintése" (döntés szerint)
- A BriefEditor-nek NE adj `onBack` prop-ot (nem kell)
- Távolítsd el a `handleBackToChat` függvényt és a `hideEditor` state-et — az áttekintés egyirányú (ha valami nem stimmel, az érdeklődő a chatben javítja)
- A `showEditor` egyszerűsödik: `briefData !== null` (nincs hideEditor toggle)
  </action>
  <verify>npx tsc --noEmit — a BriefEditor és brief page TS hiba nélkül fordul. A BriefEditor nem tartalmaz input/textarea elemeket a read-only szekcióban (csak az email mező).</verify>
  <done>A BriefEditor read-only áttekintést mutat a flat BriefData sémával, email mező + jóváhagyás gomb + PDF letöltés gomb van rajta, a success oldalon tegező szöveg és PDF letöltés link van. A brief page "Brief áttekintése" gombot mutat és nincs "vissza a chatbe" lehetőség.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — nincs TS hiba a módosított fájlokban
2. A BriefEditor NEM tartalmaz szerkeszthető input/textarea elemeket (kivéve email cím)
3. A brief page-en a gomb szövege "Brief áttekintése"
4. A getActiveSections üres BriefData-val üres tömböt ad vissza
5. A getActiveSections egy media_buying + performance_ppc campaign_types-szal mindkét típus szekcióját visszaadja
</verification>

<success_criteria>
- Read-only áttekintés a flat BriefData sémával (nincs szerkeszthető mező, kivéve email)
- Dinamikus szekciók: üres mezők nem jelennek meg, típusspecifikus blokkok kampánytípus alapján
- Email mező + jóváhagyás gomb + PDF letöltés gomb
- Siker oldal tegező szöveggel + PDF letöltés + új brief gomb
</success_criteria>

<output>
After completion, create `.planning/phases/03-dynamic-report-branding/03-01-SUMMARY.md`
</output>
