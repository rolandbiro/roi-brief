---
phase: 03-dynamic-report-branding
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/pdf-fonts.ts
  - lib/pdf-logo.tsx
  - lib/pdf-template.tsx
autonomous: true

must_haves:
  truths:
    - "A PDF-ben Archivo betűtípus van (nem Helvetica)"
    - "A PDF-ben ROI Works logó megjelenik a fejlécben"
    - "A PDF dinamikus szekciókat tartalmaz a kampánytípus alapján"
    - "Üres mezők nem jelennek meg a PDF-ben"
    - "A PDF ROI Works arculati színeket használ (narancs #FF6400, kék #0022D2)"
  artifacts:
    - path: "lib/pdf-fonts.ts"
      provides: "Archivo font regisztráció a @react-pdf/renderer-hez"
    - path: "lib/pdf-logo.tsx"
      provides: "ROI Works logó @react-pdf/renderer SVG komponensként"
    - path: "lib/pdf-template.tsx"
      provides: "Dinamikus BriefPDF komponens flat BriefData sémával"
      exports: ["BriefPDF"]
  key_links:
    - from: "lib/pdf-template.tsx"
      to: "lib/pdf-fonts.ts"
      via: "import side-effect (Font.register modul szinten fut)"
      pattern: "import.*pdf-fonts"
    - from: "lib/pdf-template.tsx"
      to: "lib/pdf-logo.tsx"
      via: "PdfLogo komponens a fejlécben"
      pattern: "PdfLogo"
---

<objective>
PDF template átírás flat BriefData sémára, ROI Works arculattal (Archivo font, logó, márka színek).

Purpose: A PDF riport dinamikusan alkalmazkodik a kampánytípusokhoz és ROI Works arculatban jelenik meg. Ez a send-brief route és a letöltés API endpoint alapja.
Output: lib/pdf-fonts.ts + lib/pdf-logo.tsx + átírt lib/pdf-template.tsx
</objective>

<execution_context>
@/Users/biroroland/.claude/get-shit-done/workflows/execute-plan.md
@/Users/biroroland/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-dynamic-report-branding/03-RESEARCH.md
@lib/pdf-template.tsx
@lib/schemas/brief-data.ts
@lib/schemas/brief-base.ts
@components/Logo.tsx
@types/brief.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Font regisztráció + PDF logó komponens</name>
  <files>lib/pdf-fonts.ts, lib/pdf-logo.tsx</files>
  <action>
**lib/pdf-fonts.ts:**

1. Import `Font` from `@react-pdf/renderer`.
2. A Google Fonts gstatic TTF URL-eket a következő paranccsal nyerd ki:
   ```
   curl -sA "Mozilla/5.0" "https://fonts.googleapis.com/css2?family=Archivo:wght@400;500;700;900"
   ```
   Ebből a TTF URL-eket (src: url(...) format('truetype')) használd.
3. `Font.register()` az Archivo-hoz: 400 (Regular), 700 (Bold), 900 (Black) fontWeight-tel.
4. `Font.registerHyphenationCallback(word => [word])` — hyphenation kikapcsolás (magyar szövegeknél fontos).
5. Ne csinálj semmit az Archivo SemiExpanded-del — a PDF-ben a normál Archivo elegendő (az SVG logó szöveget Path-ként rajzoljuk vagy Image-ként oldjuk meg).

**lib/pdf-logo.tsx:**

1. Import: `Svg, Path, G` from `@react-pdf/renderer`.
2. `PdfLogo({ width = 120 }: { width?: number })` komponens:
   - A Logo.tsx SVG-jéből az ikonrészt (3 ascending bar) vedd át `@react-pdf/renderer` SVG komponensként.
   - A szöveges "ROI WORKS" részt NE SVG Text-ként rajzold (a @react-pdf/renderer SVG Text + custom font problémás — research pitfall #2). Ehelyett: hagyd ki a szöveget az SVG-ből, a hívó oldalon (pdf-template.tsx) a logó mellé normál `<Text>` elemben írd ki a "ROI WORKS" szöveget Archivo fonttal.
   - viewBox: "0 0 38 40" (csak az ikon rész: 3 bar, max x=38, max y=40)
   - Pontosan a Logo.tsx-ből másold a Path d attribútumokat:
     - `d="M0 40 L0 22 L10 12 L10 40 Z"` fill="#FF6400"
     - `d="M14 40 L14 14 L24 4 L24 40 Z"` fill="#FF6400"
     - `d="M28 40 L28 26 L38 16 L38 40 Z"` fill="#FF6400"
3. Export: `PdfLogo`.
  </action>
  <verify>npx tsc --noEmit lib/pdf-fonts.ts lib/pdf-logo.tsx — nincs TS hiba. A font URL-ek valós Google Fonts URL-ek (curl-lal ellenőrizd).</verify>
  <done>Az Archivo font regisztrálva van a @react-pdf/renderer-ben, és a PdfLogo komponens rendereli a 3 narancs bár ikont SVG-ként.</done>
</task>

<task type="auto">
  <name>Task 2: PDF template átírás flat sémára + dinamikus szekciók + arculat</name>
  <files>lib/pdf-template.tsx</files>
  <action>
A jelenlegi pdf-template.tsx TELJES ÁTÍRÁS a flat BriefData sémára és az arculati útmutatóra.

1. **Import:** `import "@/lib/pdf-fonts"` (side-effect — Font.register fut), PdfLogo from pdf-logo, BriefData + CampaignType + CAMPAIGN_TYPE_LABELS from types/brief.

2. Implementáld a saját dinamikus szekció logikáját közvetlenül a fájlban (NEM importálva lib/brief-sections.ts-ből — mert az HTML-re van, ez @react-pdf/renderer elemekre). A logika hasonló de @react-pdf/renderer View/Text komponenseket használ:
   - `hasValue()` — ugyanaz mint a brief-sections.ts-ben
   - `getNestedValue()` — ugyanaz
   - `formatValue()` — ugyanaz
   - Szekció definíciók (BASE + type-specific) — duplikálva a brief-sections.ts-ből (sajnos szükséges, mert a renderelő komponensek mások)

3. **Stílusok (StyleSheet.create):**
   - page: fontFamily "Archivo" (nem Helvetica!), padding 40, backgroundColor white
   - header: flexDirection row, justifyContent space-between, alignItems center, marginBottom 30, paddingBottom 20, borderBottomWidth 2, borderBottomColor #FF6400
   - logoContainer: flexDirection row, alignItems center, gap 8
   - logoText: fontSize 18, fontWeight 900, color #2A2B2E
   - logoTextAccent: color #FF6400
   - date: fontSize 10, color #3C3E43
   - campaignTypes: flexDirection row, gap 6, marginBottom 20
   - typeBadge: backgroundColor "#FF6400", paddingVertical 3, paddingHorizontal 8, borderRadius 4
   - typeBadgeText: fontSize 8, color white, fontWeight 700
   - section: marginBottom 20
   - sectionTitle: fontSize 14, fontWeight 700, color #FF6400, marginBottom 10, paddingBottom 5, borderBottomWidth 1, borderBottomColor #E3E3E3
   - row: flexDirection row, marginBottom 6
   - label: fontSize 10, color #3C3E43, width 140
   - value: fontSize 10, color #2A2B2E, flex 1
   - footer: position absolute, bottom 30, left 40, right 40, textAlign center, fontSize 8, color #3C3E43, paddingTop 10, borderTopWidth 1, borderTopColor #E3E3E3

4. **BriefPDF komponens:**
   - Fejléc: PdfLogo (width=30) + "ROI" Text (fontWeight 900, color #2A2B2E) + "WORKS" Text (color #FF6400) | Dátum (jobb oldalon)
   - Kampánytípus badge-ek: campaign_types map → CAMPAIGN_TYPE_LABELS → narancs badge-ek
   - Szekciók: iteráld a BASE_SECTIONS-t és a releváns TYPE_SECTIONS-öket. Minden szekció:
     - Cím: sectionTitle stílus
     - Mezők: ahol hasValue true → row (label + value)
     - Kihagyás: ha a szekcióban nincs egyetlen kitöltött mező sem
   - Footer: "Ez a dokumentum a ROI Works AI Brief rendszerrel készült. • {dátum}" + "© 2026 ROI Works"

5. **Fontos: a régi nested elérések (data.company.name, data.campaign.goal, stb.) MIND eltűnnek.** A flat séma mezőit használd (company_name, campaign_goal, stb.) a szekció definíciókon keresztül.
  </action>
  <verify>npx tsc --noEmit lib/pdf-template.tsx — nincs TS hiba. A BriefPDF export létezik és BriefData-t fogad.</verify>
  <done>A PDF template a flat BriefData sémát használja, dinamikus szekciókat renderel kampánytípus alapján, és ROI Works arculatban jelenik meg (Archivo font, narancs/kék színek, logó).</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — nincs TS hiba a 3 fájlban
2. A pdf-template.tsx NEM tartalmaz régi nested eléréseket (data.company.name, data.campaign.goal, stb.)
3. A fontFamily "Archivo" van beállítva (nem "Helvetica")
4. A PdfLogo SVG Path-okat használ (nem SVG Text-et)
</verification>

<success_criteria>
- Archivo font regisztrálva, PDF-ben használva
- ROI Works logó ikon a fejlécben (SVG Path, nem Text)
- Dinamikus szekciók: üres mezők nem jelennek meg, típusspecifikus blokkok kampánytípus alapján
- Arculati színek: narancs #FF6400, kék #0022D2, szürke #E3E3E3, sötét #2A2B2E
</success_criteria>

<output>
After completion, create `.planning/phases/03-dynamic-report-branding/03-02-SUMMARY.md`
</output>
